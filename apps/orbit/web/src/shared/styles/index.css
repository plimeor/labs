@layer theme, base, mantine, components, utilities;

@import "tailwindcss";
@import "@mantine/core/styles.layer.css";

/* ============================================
   Orbit Design System — Tailwind v4 Theme
   Light + Dark Mode with CSS Variables
   ============================================ */

@theme {
  /* Accent */
  --color-accent: var(--orbit-accent);
  --color-accent-hover: var(--orbit-accent-hover);
  --color-accent-light: var(--orbit-accent-light);
  --color-accent-muted: var(--orbit-accent-muted);

  /* Surfaces */
  --color-surface: var(--orbit-surface);
  --color-surface-secondary: var(--orbit-surface-secondary);
  --color-surface-elevated: var(--orbit-surface-elevated);

  /* Text */
  --color-text-primary: var(--orbit-text-primary);
  --color-text-secondary: var(--orbit-text-secondary);
  --color-text-tertiary: var(--orbit-text-tertiary);
  --color-text-accent: var(--orbit-text-accent);

  /* Borders */
  --color-border-default: var(--orbit-border-default);
  --color-border-subtle: var(--orbit-border-subtle);

  /* Status */
  --color-status-success: var(--orbit-status-success);
  --color-status-warning: var(--orbit-status-warning);
  --color-status-error: var(--orbit-status-error);
  --color-status-info: var(--orbit-status-info);
}

/* ============================================
   Light Mode (default)
   ============================================ */

:root {
  --orbit-accent: #7c5cbf;
  --orbit-accent-hover: #6b4cad;
  --orbit-accent-light: #f3eefa;
  --orbit-accent-muted: #e8ddf5;

  --orbit-surface: #fafaf9;
  --orbit-surface-secondary: #f5f4f2;
  --orbit-surface-elevated: #ffffff;

  --orbit-text-primary: #1a1a1e;
  --orbit-text-secondary: #6b6b76;
  --orbit-text-tertiary: #9b9ba6;
  --orbit-text-accent: #7c5cbf;

  --orbit-border-default: #e8e7e5;
  --orbit-border-subtle: #f0efed;

  --orbit-status-success: #22c55e;
  --orbit-status-warning: #f59e0b;
  --orbit-status-error: #ef4444;
  --orbit-status-info: #7c5cbf;

  /* Shadows — light mode uses subtle rings + soft blur */
  --shadow-soft: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-card: 0 0 0 1px rgba(0, 0, 0, 0.05), 0 2px 8px rgba(0, 0, 0, 0.06);
  --shadow-elevated: 0 0 0 1px rgba(0, 0, 0, 0.05), 0 8px 24px rgba(0, 0, 0, 0.08), 0 2px 8px rgba(0, 0, 0, 0.04);
  --shadow-minimal: 0 0 0 1px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.03);
  --shadow-middle: 0 0 0 1px rgba(0, 0, 0, 0.04), 0 2px 12px rgba(0, 0, 0, 0.06);
  --shadow-tinted: 0 0 0 1px rgba(124, 92, 191, 0.06), 0 2px 12px rgba(124, 92, 191, 0.08);
}

/* ============================================
   Dark Mode
   ============================================ */

.dark {
  --orbit-accent: #9b7fd4;
  --orbit-accent-hover: #b196e0;
  --orbit-accent-light: rgba(155, 127, 212, 0.12);
  --orbit-accent-muted: rgba(155, 127, 212, 0.18);

  --orbit-surface: #19191d;
  --orbit-surface-secondary: #131315;
  --orbit-surface-elevated: #252529;

  --orbit-text-primary: #e8e8ec;
  --orbit-text-secondary: #9b9ba6;
  --orbit-text-tertiary: #6b6b76;
  --orbit-text-accent: #b196e0;

  --orbit-border-default: #2e2e34;
  --orbit-border-subtle: #2a2a30;

  --orbit-status-success: #34d399;
  --orbit-status-warning: #fbbf24;
  --orbit-status-error: #f87171;
  --orbit-status-info: #9b7fd4;

  /* Shadows — dark mode uses stronger ring borders + deeper blur */
  --shadow-soft: 0 0 0 1px rgba(255, 255, 255, 0.06), 0 1px 3px rgba(0, 0, 0, 0.3);
  --shadow-card: 0 0 0 1px rgba(255, 255, 255, 0.08), 0 2px 8px rgba(0, 0, 0, 0.3);
  --shadow-elevated: 0 0 0 1px rgba(255, 255, 255, 0.08), 0 8px 24px rgba(0, 0, 0, 0.4), 0 2px 8px rgba(0, 0, 0, 0.24);
  --shadow-minimal: 0 0 0 1px rgba(255, 255, 255, 0.06), 0 1px 2px rgba(0, 0, 0, 0.2);
  --shadow-middle: 0 0 0 1px rgba(255, 255, 255, 0.06), 0 2px 12px rgba(0, 0, 0, 0.3);
  --shadow-tinted: 0 0 0 1px rgba(155, 127, 212, 0.12), 0 2px 12px rgba(155, 127, 212, 0.15);
}

/* ============================================
   Base Styles
   ============================================ */

html {
  font-size: 15px;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  background: var(--orbit-surface);
  color: var(--orbit-text-primary);
  transition:
    background-color 200ms ease,
    color 200ms ease;
}

/* ============================================
   Custom Scrollbar
   ============================================ */

::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: var(--orbit-text-tertiary);
  border-radius: 3px;
  opacity: 0.5;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--orbit-text-secondary);
}

/* ============================================
   Selection
   ============================================ */

::selection {
  background: var(--orbit-accent-muted);
  color: var(--orbit-text-primary);
}

/* ============================================
   Transition Utility
   ============================================ */

.transition-colors-smooth {
  transition:
    background-color 150ms ease,
    border-color 150ms ease,
    color 150ms ease;
}

/* ============================================
   Focus Styles
   ============================================ */

:focus-visible {
  outline: 2px solid var(--orbit-accent);
  outline-offset: 2px;
  border-radius: 4px;
}

/* ============================================
   Animations
   ============================================ */

@keyframes fade-in {
  from {
    opacity: 0;
    transform: translateY(4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slide-up {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes crossfade {
  0% {
    opacity: 0;
    transform: translateY(4px);
  }
  15% {
    opacity: 1;
    transform: translateY(0);
  }
  85% {
    opacity: 1;
    transform: translateY(0);
  }
  100% {
    opacity: 0;
    transform: translateY(-4px);
  }
}

@keyframes shimmer-text {
  0% {
    background-position: -200% center;
  }
  100% {
    background-position: 200% center;
  }
}

@keyframes pulse-dot {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.4;
  }
}

@utility animate-fade-in {
  animation: fade-in 200ms ease-out;
}

@utility animate-slide-up {
  animation: slide-up 300ms ease-out;
}

@utility animate-shimmer-text {
  background: linear-gradient(90deg, currentColor 40%, var(--orbit-text-tertiary) 50%, currentColor 60%);
  background-size: 200% auto;
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: shimmer-text 2s linear infinite;
}

@utility animate-pulse-dot {
  animation: pulse-dot 1.5s ease-in-out infinite;
}

/* ============================================
   Mantine Overrides
   ============================================ */

.mantine-ScrollArea-viewport {
  scrollbar-width: none;
}

/* Make the chat scroll area's inner content wrapper fill the viewport height so
   flex centering works for the empty state. Mantine ScrollArea wraps children in
   an extra div that defaults to display:table — override it for the chat area. */
.chat-scroll-area .mantine-ScrollArea-viewport > div {
  min-height: 100%;
  display: flex !important;
  flex-direction: column;
}

.mantine-ScrollArea-viewport::-webkit-scrollbar {
  display: none;
}

/* Remove focus ring from unstyled Mantine inputs — the parent container handles focus styling */
.mantine-Textarea-input:focus-visible,
.mantine-TextInput-input:focus-visible {
  outline: none;
}

/* ============================================
   Prose — Markdown Content Typography
   ============================================ */

.prose-orbit {
  line-height: 1.7;
  color: var(--orbit-text-primary);
}

.prose-orbit h1 {
  font-size: 1.5rem;
  font-weight: 600;
  margin-top: 1.5rem;
  margin-bottom: 0.75rem;
  line-height: 1.3;
}

.prose-orbit h2 {
  font-size: 1.25rem;
  font-weight: 600;
  margin-top: 1.25rem;
  margin-bottom: 0.5rem;
  line-height: 1.35;
}

.prose-orbit h3 {
  font-size: 1.1rem;
  font-weight: 600;
  margin-top: 1rem;
  margin-bottom: 0.5rem;
  line-height: 1.4;
}

.prose-orbit p {
  margin-bottom: 0.75rem;
}

.prose-orbit p:last-child {
  margin-bottom: 0;
}

.prose-orbit ul,
.prose-orbit ol {
  margin-bottom: 0.75rem;
  padding-left: 1.5rem;
}

.prose-orbit ul {
  list-style-type: disc;
}

.prose-orbit ol {
  list-style-type: decimal;
}

.prose-orbit li {
  margin-bottom: 0.25rem;
}

.prose-orbit li > ul,
.prose-orbit li > ol {
  margin-top: 0.25rem;
  margin-bottom: 0;
}

.prose-orbit blockquote {
  border-left: 3px solid var(--orbit-accent-muted);
  padding-left: 1rem;
  margin-bottom: 0.75rem;
  color: var(--orbit-text-secondary);
  font-style: italic;
}

.prose-orbit table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 0.75rem;
  font-size: 0.9em;
}

.prose-orbit th,
.prose-orbit td {
  padding: 0.5rem 0.75rem;
  text-align: left;
  border-bottom: 1px solid var(--orbit-border-subtle);
}

.prose-orbit th {
  font-weight: 600;
  color: var(--orbit-text-primary);
  border-bottom-color: var(--orbit-border-default);
}

.prose-orbit a {
  color: var(--orbit-text-accent);
  text-decoration: none;
}

.prose-orbit a:hover {
  text-decoration: underline;
}

.prose-orbit hr {
  border: none;
  border-top: 1px solid var(--orbit-border-subtle);
  margin: 1rem 0;
}

.prose-orbit img {
  max-width: 100%;
  border-radius: 8px;
}

.prose-orbit > *:first-child {
  margin-top: 0;
}

/* ============================================
   Code block dark mode support
   ============================================ */

.dark .prose-orbit code:not(pre code) {
  background: var(--orbit-surface-elevated);
}
